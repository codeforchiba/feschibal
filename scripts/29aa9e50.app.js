riot.tag("app",'<app-header></app-header><div class="content"><home if="{path === \'home\'}" listener="{listener}"></home><search if="{path === \'search\'}" listener="{listener}"></search><fes-detail-modal fes="{fes}"></fes-detail-modal></div><app-footer></app-footer>',"app .content { padding: 15px; }",function(){var a=this;this.path=null,this.fes=null,this.listener={onSelectFes:function(b){a.fes=b,a.update(),$("fes-detail-modal > div").modal("show")}},riot.route.on("routeChange",function(b){console.log("routeChange path="+b),a.path=b,a.update()})}),riot.tag("app-header",'<div class="navbar navbar-inverse navbar-fixed-top" role="navigation"><div class="container-fluid"><div class="navbar-header"><a class="navbar-brand" href="#">Feschibal</a></div></div></div>',function(){}),riot.tag("app-footer",'<footer class="well well-sm"><small>footer of Feschibal</small></footer>',function(){}),riot.tag("home",'<div class="panel panel-default"><div class="panel-heading"><h3 class="panel-title">直近に開催される祭り</h3></div><div class="panel-body"><fes-list listener="{opts.listener}" request="{request}"></fes-list></div></div><div class="panel panel-default"><div class="panel-heading"><h3 class="panel-title">祭りを検索する</h3></div><div class="panel-body row"><div class="col-lg-6"><h4>地域から探す</h4></div><div class="col-lg-6"><h4>日付から探す</h4><table class="table"><tbody><tr><td><a href="#search/list?param1=value1&param2=value2">本日開催の祭り</a></td></tr><tr><td><a href="#search/list?param1=value3&param2=value4">今週開催の祭り</a></td></tr><tr><td><a href="#search/list?param1=value5&param2=value6">今度の土日開催の祭り</a></td></tr></tbody></table></div></div></div>',function(){var a=this;this.request=riot.observable(),riot.route.on("home",function(b){console.log("attach home param="+JSON.stringify(b)),$.getJSON("data/home-test-data.json",function(b){a.request.trigger("loaded",b)})})}),riot.tag("search",'<div class="row"><div class="col-lg-3"><div class="panel panel-default"><div class="panel-heading"><h3 class="panel-title">祭りを検索する</h3></div><div class="panel-body"><form class="form-horizontal" onsubmit="{onSubmitSearch}"><h4>期間を指定する</h4><div class="form-group"><label for="fromDate" class="col-sm-2 control-label">From:</label><div class="col-sm-10"><input type="text" class="form-control" id="fromDate" ></div></div><div class="form-group"><label for="toDate" class="col-sm-2 control-label">To:</label><div class="col-sm-10"><input type="text" class="form-control" id="toDate" ></div></div><h4>地域を指定する</h4><div class="form-group"><div class="col-sm-offset-2 col-sm-10"><button type="submit" class="btn btn-default">検索する</button></div></div></form></div></div></div><div class="col-lg-9"><ul class="nav nav-tabs"><li role="presentation" class="{active: path===\'list\'}"><a href="#search/list?{queryString}">一覧表示</a></li><li role="presentation" class="{active: path===\'cal\'}"><a href="#search/cal?{queryString}">カレンダー表示</a></li></ul><div><fes-list if="{path === \'list\'}" request="{request}" listener="{opts.listener}"></fes-list><fes-calendar if="{path === \'cal\'}" request="{request}" listener="{opts.listener}"></fes-calendar></div></div></div>',function(){var a=this,b={format:"yyyy/mm/dd",language:"ja",orientation:"top",todayHighlight:!0,autoclose:!0,clearBtn:!0};$(this.fromDate).datepicker(b),$(this.toDate).datepicker(b),this.request=riot.observable(),this.path=null,this.queryString=null,this.onSubmitSearch=function(){}.bind(this),riot.route.on("routeChange:search",function(b){console.log("routeChange:search path="+b),a.path=b,a.update()}),riot.route.on("search",function(b){console.log("attach search param="+JSON.stringify(b)),a.queryString=$.param(b),a.update(),$.getJSON("data/test-data.json",function(b){return a.request.trigger("loaded",b),!1})})}),riot.tag("fes-list",'<div class="row"><div class="col-lg-3"><table class="table table-hover"><thead><tr><th>検索結果：100 件中 1-10 件</th></tr></thead><tbody><tr each="{fes, i in fesList}" onclick="{parent.onSelectFes}"><td><div>{fes.start}</div><div>{fes.name}</div></td></tr></tbody></table><nav><ul class="pager"><li class="previous disabled"><a href="javascript:void(0);"><span aria-hidden="true">&larr;</span> 前へ</a></li><li class="next"><a href="javascript:void(0);">次へ <span aria-hidden="true">&rarr;</span></a></li></ul></nav></div><div class="col-lg-9" id="map"></div></div>',"#map { height: 500px; }",function(a){var b=this;b.fesList=[],a.request.on("loaded",function(a){b.fesList=a,b.update();var c={type:"FeatureCollection",features:[]};c.features=_.map(a,function(a){return{type:"Feature",geometry:{type:"Point",coordinates:a.coordinates},properties:a}}),e.clearLayers(),e.addData(c)});var c,d=L.tileLayer("http://cyberjapandata.gsi.go.jp/xyz/std/{z}/{x}/{y}.png",{maxZoom:18,attribution:"<a href='http://www.gsi.go.jp/kikakuchousei/kikakuchousei40182.html' target='_blank'>国土地理院</a>",opacity:.8}),e=L.geoJson(null,{pointToLayer:function(a,b){return L.marker(b).bindLabel(a.properties.name,{noHide:!0})},onEachFeature:function(b,c){c.on({click:function(){a.listener.onSelectFes(b.properties)}})}}),f=$(this.map),g=setInterval(function(){f.length&&f.is(":visible")&&(clearInterval(g),c=L.map(f[0]).setView([35.6098733,140.1138984],12),d.addTo(c),e.addTo(c))},50);this.onSelectFes=function(a){c.panTo(new L.LatLng(a.item.fes.coordinates[1],a.item.fes.coordinates[0]))}.bind(this)}),riot.tag("fes-calendar",'<div id="calendar"></div>',"fes-calendar .fc-event { margin-bottom: 5px; padding: 5px; cursor: pointer; } fes-calendar .fc-event:hover { opacity: 0.8; } fes-calendar .fc-event .fc-content { white-space: normal; } fes-calendar .fc-event .fc-content .fc-time { display: block; }",function(a){var b=this,c=$(this.calendar),d=[];riot.route.on("search/cal",function(){c.fullCalendar({lang:"ja",eventClick:function(b){return a.listener.onSelectFes(b.fes),!1},events:d})}),a.request.on("loaded",function(a){b.fesList=a,d=_.map(a,function(a){return{title:a.name,start:a.start,end:a.end,fes:a}}),c.fullCalendar("removeEvents"),c.fullCalendar("addEventSource",d)})}),riot.tag("fes-detail-modal",'<div class="modal fade" tabindex="-1" role="dialog"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button class="close" type="button" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title text-primary">{opts.fes.name}</h4></div><div class="modal-body"><div class="panel panel-section"><div class="panel-heading"><h3 class="panel-title">期間</h3></div><div class="panel-body"> 2015年3月6日（金曜日）11時00分から2015年3月6日（金曜日）11時30分 </div></div><div class="panel panel-section"><div class="panel-heading"><h3 class="panel-title">祭り内容</h3></div><div class="panel-body"><dl class="dl-horizontal"><dt>目玉</dt><dd>2千人規模で踊る親子三代千葉おどり</dd></dl><img src="../../images/chiba-odori.jpg" alt=""></div><table class="table table-bordered"><thred><tr><th>踊り</th><th>歌唱</th><th>太鼓</th><th>演奏</th><th>出店・屋台</th><th>花火</th><th>その他</th></tr></thred><tbody><tr><td><i class="fa fa-check"></i></td><td></td><td><i class="fa fa-check"></i></td><td></td><td><i class="fa fa-check"></i></td><td><i class="fa fa-check"></i></td><td class="other">スポーツイベント、フリーマーケット</td></tr></tbody></table><dl class="dl-horizontal"><dt>祭り公式サイト</dt><dd><a href="http://www.bikai.org/matsuri.html">http://www.bikai.org/matsuri.html</a></dd></dl></div><div class="panel panel-section"><div class="panel-heading"><h3 class="panel-title">場所</h3></div><div class="panel-body"><dl class="dl-horizontal"><dt>会場</dt><dd>中央公園</dd><dt>住所</dt><dd>中央区中央1-12-1</dd></dl><div id="detail-map"></div></div></div><div class="panel panel-section"><div class="panel-heading"><h3 class="panel-title">主催、共催、後援</h3></div><div class="panel-body"><dl class="dl-horizontal"><dt>主催</dt><dd>千葉市を美しくする会</dd><dt>共催</dt><dd>千葉市市民自治推進課</dd><dt>担当者</dt><dd>千葉 祭</dd><dt>電話番号</dt><dd>043-999-9999</dd></dl></div></div></div><div class="modal-footer"><button type="button" class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div>',"fes-detail-modal .panel.panel-section { -webkit-box-shadow: none; box-shadow: none; } fes-detail-modal .panel.panel-section .panel-heading { border-bottom: 3px solid #e5e5e5; } fes-detail-modal .dl-horizontal dt { width: 60px; } fes-detail-modal .dl-horizontal dd { margin-left: 80px; } fes-detail-modal .table.table-bordered th, fes-detail-modal .table.table-bordered td { text-align: center; } fes-detail-modal .table.table-bordered td.other { text-align: left; } fes-detail-modal #detail-map { height: 300px; }",function(a){var b=$(this["detail-map"]),c=setInterval(function(){if(b.length&&b.is(":visible")){clearInterval(c);var d=L.map(b[0]).setView([a.fes.coordinates[1],a.fes.coordinates[0]],14);L.marker([a.fes.coordinates[1],a.fes.coordinates[0]]).addTo(d),L.tileLayer("http://cyberjapandata.gsi.go.jp/xyz/std/{z}/{x}/{y}.png",{maxZoom:18,attribution:"<a href='http://www.gsi.go.jp/kikakuchousei/kikakuchousei40182.html' target='_blank'>国土地理院</a>",opacity:.8}).addTo(d)}},50)}),function(){riot.route.parser(function(a){var b=a.split("?"),c=[b[0]],d=b[1],e={};return d&&d.split("&").forEach(function(a){var b=a.split("=");e[b[0]]=b[1]}),c.push(e),c}),riot.observable(riot.route);var a="",b=null,c=function(c,d){c=c||"home";for(var e=c.split("/"),f=a.split("/"),g="",h=0;h<e.length;h++){var i=e[h],j=f[h];i!==j?(riot.route.trigger("routeChange"+(""===g?"":":")+g,i),g+=(""===g?"":"/")+i,riot.route.trigger(g,d)):_.isEqual(d,b)?g+=(""===g?"":"/")+i:(g+=(""===g?"":"/")+i,riot.route.trigger(g,d))}a=c,b=d};riot.route(c),riot.route.build=function(){this.exec(c)}}();