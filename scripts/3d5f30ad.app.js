riot.tag("pager",'<nav><ul class="pager"><li class="{previous: true, disabled: isDisablePreviousBtn}" ><a href="javascript:void(0);" onclick="{onClickBeforePage}" ><span aria-hidden="true">&larr;</span> 前へ</a></li><li class="{next:true, disabled: isDisableNextBtn}"><a href="javascript:void(0);" onclick="{onClickNextPage}">次へ <span aria-hidden="true">&rarr;</span></a></li></ul></nav>',function(a){var b=this;this.isDisablePreviousBtn=!1,this.isDisableNextBtn=!1,this.onClickBeforePage=function(){b.isDisablePreviousBtn||a.listener.onPageChange(a.result.pageNo-1)}.bind(this),this.onClickNextPage=function(){b.isDisableNextBtn||a.listener.onPageChange(a.result.pageNo+1)}.bind(this),this.on("update",function(){b.isDisablePreviousBtn=0===a.result.pageNo,b.isDisableNextBtn=a.result.total<=a.result.limit*(a.result.pageNo+1)})}),riot.tag("app","<app-header></app-header><home show=\"{path === 'home'}\"></home><search show=\"{path === 'search'}\"></search><fes-detail show=\"{path === 'detail'}\"></fes-detail><app-footer></app-footer>",function(a){var b=this;this.path=null,this.fes=null,riot.route.on("routeChange",function(a){b.path=a,b.update()})}),riot.tag("app-header",'<header><div class="header-content"><h1><a class="roll_fout" href="#"><img src="images/common/04c504f7.logo.png" alt="千葉市お祭りデータセンター"></a></h1></div></header>',"app-header header { background-color: #fff; } app-header h1 { padding: 10px 0px; } app-header .header-content { width: 1000px; margin: 0 auto; } @media only screen and (max-width: 640px) { app-header h1 { padding: 10px 0px 10px 10px; } app-header h1 img { width: 70%; } app-header .header-content { width: 100%; } }",function(a){}),riot.tag("app-footer",'<footer><p><img src="images/common/403c5bdd.codeforchiba.gif" alt="Code For Chiba"></p><p class="copyright">Copyright &copy; Code for Chiba All rights reserved.</p></footer>',"app-footer footer { background: #fff url(images/common/dc1f9a34.footer-line.gif) left top repeat-x; padding-top: 30px; } app-footer p { text-align: center; } app-footer .copyright { background: #2c2c2c; padding: 10px 0; color: #fff; margin-bottom: 0; } @media only screen and (max-width: 640px) { app-footer footer { background: #fff url(images/common/dc1f9a34.footer-line.gif) left top repeat-x; } app-footer p { text-align: center; } app-footer p img { width: 50%; } app-footer .copyright { background: #2c2c2c; padding: 20px 0; color: #fff; } }",function(a){}),riot.tag("home",'<div class="main"><div class="main-img"><img src="images/home/31ad2c57.main.jpg" alt="千葉市お祭りデータセンター"></div></div><article class="content"><section class="homesearch"><div class="homesearch-list"><a href="#"><img src="images/common/b7dce72d.homesearch-icon01.png"><p>地域から探す</p></a></div><div class="homesearch-list"><a href="javascript:void(0)" onclick="{doSearchToday}"><img src="images/common/b7dce72d.homesearch-icon02.png"><p>本日開催の祭り</p></a></div><div class="homesearch-list"><a href="javascript:void(0)" onclick="{doSearchThisWeekEnd}"><img src="images/common/b7dce72d.homesearch-icon03.png"><p>土日開催の祭り</p></a></div></section><section class="week"><dl class="week-day"><dt>今週開催の祭り</dt><dd>{moment(startDateOfWeek).format(\'M/D\')} - {moment(endDateOfWeek).format(\'M/D\')}</dd></dl><div class="week-map"><fes-map feslist="{result.list}"></fes-map></div><fes-list feslist="{result.list}"></fes-list></section></article>',"home .homesearch { background: #f5ac42; margin-bottom: 30px; } home .homesearch .homesearch-list { float: left; width: 33.2%; border-right: #cb7e01 solid 1px; font-size: 20px; font-weight: bold; text-align: center; } home .homesearch .homesearch-list a { display: block; color: #fff; padding: 20px 0px; text-decoration: none; } home .homesearch .homesearch-list a p { margin-bottom: 0px; } home .homesearch .homesearch-list a:hover { background: #ff9700; } home .homesearch .homesearch-list:last-child { border-right: none; } home .homesearch:after { content: \".\"; display: block; height: 0; font-size: 0; clear: both; visibility: hidden; } home .week .week-day { margin-bottom: 30px; } home .week .week-day dt { font-size: 20px; font-weight: bold; text-align: center; } home .week .week-day dd { font-size: 36px; font-family: sans-serif; text-align: center; padding-bottom: 20px; font-weight: 400; font-family: 'Merriweather', serif; letter-spacing: 0.1em; background: url(images/common/00b976b5.week-day-bg01.gif) top 18px left 200px no-repeat, url(images/common/00b976b5.week-day-bg01.gif) top 18px right 200px no-repeat, url(images/common/12771e09.week-day-bg02.gif) center bottom 0px no-repeat; } home .week .week-map { margin-bottom: 30px; } home .week .week-map #map-result { height: 240px; width: 100%; } @media only screen and (max-width: 640px) { home .homesearch .homesearch-list { width: 33.1%; font-size: 14px; } home .homesearch .homesearch-list a { padding: 10px 0px; } home .homesearch .homesearch-list a img { width: 40%; } home .week .week-day dt { font-size: 14px; } home .week .week-day dd { font-size: 28px; background: url(images/common/00b976b5.week-day-bg01.gif) top 11px left -60px no-repeat, url(images/common/00b976b5.week-day-bg01.gif) top 11px right -60px no-repeat, url(images/common/12771e09.week-day-bg02.gif) center bottom 0px no-repeat; } }",function(a){var b=this;this.result={},this.startDateOfWeek=moment().weekday(1).toDate(),this.endDateOfWeek=moment().weekday(7).toDate(),this.doSearchToday=function(a){var b=moment().format("YYYY-MM-DD"),c={fromDate:b,toDate:b};riot.route("search/list?"+$.param(c))}.bind(this),this.doSearchThisWeekEnd=function(a){var b={fromDate:moment().weekday(6).format("YYYY-MM-DD"),toDate:moment().weekday(7).format("YYYY-MM-DD")};riot.route("search/list?"+$.param(b))}.bind(this),riot.route.on("home",function(a){b.tags["fes-map"].trigger("show");var c={fromDate:b.startDateOfWeek,toDate:b.endDateOfWeek};cfc.Event.find(c).done(function(a){b.result=a,b.update()})})}),riot.tag("search",'<div class="row"><div class="col-lg-3"><div class="panel panel-default"><div class="panel-heading"><h3 class="panel-title">祭りを検索する</h3></div><div class="panel-body"><form class="form-horizontal" onsubmit="{onSubmitSearch}"><h4>期間を指定する</h4><div class="form-group"><label for="fromDate" class="col-sm-2 control-label">From:</label><div class="col-sm-10"><input type="text" class="form-control" id="fromDate" ></div></div><div class="form-group"><label for="toDate" class="col-sm-2 control-label">To:</label><div class="col-sm-10"><input type="text" class="form-control" id="toDate" ></div></div><h4>地域を指定する</h4><div class="form-group"><div class="col-sm-offset-2 col-sm-10"><button type="submit" class="btn btn-default">検索する</button></div></div></form></div></div></div><div class="col-lg-9"><ul class="nav nav-tabs"><li role="presentation" class="{active: path===\'list\'}"><a href="#search/list?{queryString}">一覧表示</a></li><li role="presentation" class="{active: path===\'map\'}"><a href="#search/map?{queryString}">地図</a></li><li role="presentation" class="{active: path===\'cal\'}"><a href="#search/cal?{queryString}">カレンダー表示</a></li></ul><div><search-list show="{path === \'list\'}" request="{request}" ></search-list><search-map show="{path === \'map\'}" request="{request}" ></search-map><search-calendar show="{path === \'cal\'}" request="{request}" ></search-calendar></div></div></div>',function(a){var b=this,c={format:"yyyy/mm/dd",language:"ja",orientation:"top",todayHighlight:!0,autoclose:!0,clearBtn:!0};$(this.fromDate).datepicker(c),$(this.toDate).datepicker(c),this.request=riot.observable(),this.path=null,this.queryString=null,this.onSubmitSearch=function(a){var b=riot.route.currentPath(),c={fromDate:$(this.fromDate).val().replace(/\//g,"-"),toDate:$(this.toDate).val().replace(/\//g,"-")};b+="?"+$.param(c),riot.route(b)}.bind(this),riot.route.on("routeChange:search",function(a){b.path=a,b.update()}),riot.route.on("search",function(a){b.queryString=$.param(a),a.fromDate&&$(b.fromDate).datepicker("update",new Date(a.fromDate)),a.toDate&&$(b.toDate).datepicker("update",new Date(a.toDate)),b.update()})}),riot.tag("search-list",'<div class="content"><div> 検索結果：{result.total} 件中 {result.total ? result.limit * result.pageNo + 1 : 0} - {result.limit * result.pageNo + result.list.length} 件 </div><fes-list feslist="{result.list}"></fes-list><pager result="{result}" listener="{listener}"></pager></div>',function(a){var b=this;this.result={},this.searchParam={},this.onSelectFes=function(a){riot.route("detail/"+a.item.fes.id)}.bind(this),this.listener={onPageChange:function(a){var c=b.searchParam.fromDate,d=b.searchParam.toDate,e={fromDate:c?moment(c).format("YYYY-MM-DD"):null,toDate:d?moment(d).format("YYYY-MM-DD"):null,pageNo:a};riot.route("search/list?"+$.param(e))}},riot.route.on("search/list",function(a){var c={limit:10,pageNo:a.pageNo||0,fromDate:a.fromDate?new Date(a.fromDate):null,toDate:a.toDate?new Date(a.toDate):null};cfc.Event.find(c).done(function(a){b.result=a,b.update()})})}),riot.tag("search-map",'<fes-map feslist="{feslist}"></fes-map>',"search-map #map-result { height: 500px; }",function(a){var b=this;this.feslist=[],riot.route.on("search/map",function(a){b.tags["fes-map"].trigger("show");var c={fromDate:a.fromDate?new Date(a.fromDate):null,toDate:a.toDate?new Date(a.toDate):null};cfc.Event.find(c).done(function(a){b.feslist=a.list,b.update()})})}),riot.tag("search-calendar",'<div id="calendar"></div>',"search-calendar .fc-event { margin-bottom: 5px; padding: 5px; cursor: pointer; } search-calendar .fc-event:hover { opacity: 0.8; } search-calendar .fc-event .fc-content { white-space: normal; } search-calendar .fc-event .fc-content .fc-time { display: block; }",function(a){var b=$(this.calendar);b.fullCalendar({lang:"ja",eventClick:function(a,b,c){return riot.route("detail/"+a.fes.id),!1}}),riot.route.on("search/cal",function(a){var b={fromDate:a.fromDate?new Date(a.fromDate):null,toDate:a.toDate?new Date(a.toDate):null};cfc.Event.find(b).done(c)});var c=function(a){var c=_.map(a.list,function(a){return{title:a.name,start:a.getStartDate().getTime(),end:a.getEndDate().getTime(),fes:a}});b.fullCalendar("render"),b.fullCalendar("removeEvents"),b.fullCalendar("addEventSource",c)}}),riot.tag("fes-detail",'<article if="{fes != null}"><div class="main"><div class="main-img"><img src="images/home/31ad2c57.main.jpg" alt="千葉市お祭りデータセンター"></div></div><article class="content"><div class="info-area"><div each="{date, i in fes.date}"><span class="date">{moment(date.start).format(\'MM/DD\')}</span><span class="{day-of-week:true,sat:6===date.start.getDay(),sun:0===date.start.getDay()}">{moment(date.start).format(\'dd\')}</span><i class="fa fa-clock-o"></i><span>{moment(date.start).format(\'HH:mm\')}</span><span> - </span><span>{moment(date.end).format(\'HH:mm\')}</span></div><h4 class="detail-title">{fes.name}</h4><div class="features"><i if="{fes.features.dancing}" class="fa fa-star fa-3x"></i><i if="{fes.features.singing}" class="fa fa-microphone fa-3x"></i><i if="{fes.features.drum}" class="fa fa-neuter fa-3x"></i><i if="{fes.features.musicalPerformance}" class="fa fa-music fa-3x"></i><i if="{fes.features.foodTruck}" class="fa fa-cutlery fa-3x"></i><i if="{fes.features.fireworks}" class="fa fa-fire fa-3x"></i></div><table class="fes-infos"><tbody><tr><th><span class="title-frame">会場</span></th><td>{fes.location.name}</td></tr><tr><th><span class="title-frame">備考</span></th><td>{fes.location.name}</td></tr></tbody></table></div><div id="map-detail"></div><div class="around-fes-area"><div class="title">周辺のお祭り</div><fes-list feslist="{aroundFes}"></fes-list></div></article></div>',"fes-detail .info-area { padding: 10px; } fes-detail .date { font-size: 20px; } fes-detail .day-of-week { margin-left: 5px; margin-right: 10px; } fes-detail .day-of-week.sat { color: #0000ff; } fes-detail .day-of-week.sun { color: #ff0000; } fes-detail .fa.fa-clock-o{ margin-right: 5px; } fes-detail .detail-title { color: #E39727; font-weight: bold; } fes-detail .features .fa { border: solid 3px; width: 50px; height: 50px; border-radius: 25px; text-align: center; margin-right: 5px; color: #34AAE8; } fes-detail .fes-infos { margin-top: 5px; width: 100%; } fes-detail .fes-infos th { width: 100px; text-align: center; } fes-detail .fes-infos th .title-frame{ border: solid 1px #000000; font-size: x-small; padding: 1px 15px; border-radius: 10px; } fes-detail .fes-infos th,fes-detail .fes-infos td { padding: 5px; } fes-detail #map-detail { height: 150px; width: 100%; } fes-detail .around-fes-area .title { background-color: #F4A838; color: #ffffff; padding: 5px; }",function(a){var b=this;b.fes=null,b.aroundFes=[];var c=null,d=L.map(b["map-detail"],{dragging:!1});L.tileLayer("http://{s}.mqcdn.com/tiles/1.0.0/osm/{z}/{x}/{y}.png",{maxZoom:18,subdomains:["otile1","otile2","otile3","otile4"],attribution:'Tiles courtesy of <a href="http://www.mapquest.com/" target="_blank">MapQuest</a> <img src="http://developer.mapquest.com/content/osm/mq_logo.png">. Map data (c) <a href="http://www.openstreetmap.org/" target="_blank">OpenStreetMap</a> contributors, CC-BY-SA.'}).addTo(d),riot.route.on("routeChange:detail",function(a){cfc.Event.findOne(a).done(function(a){b.fes=a,b.update(),c&&d.removeLayer(c),c=L.marker([a.location.lat,a.location["long"]]),c.addTo(d),d.setView([a.location.lat,a.location["long"]],14),b.searchAroundRes(a)})}),this.searchAroundRes=function(a){var c=L.latLng([a.location.lat,a.location["long"]]),d={fromDate:new Date,basePoint:c,distance:5e3,limit:10,pageNo:0};cfc.Event.find(d).done(function(c){b.aroundFes=_.filter(c.list,function(b){return a.id!==b.id}),b.update()})}.bind(this),this.onSelectFes=function(a){riot.route("detail/"+a.item.fes.id)}.bind(this)}),riot.tag("fes-list",'<ul class="festival-list"><li class="festival-list-date" each="{fes, i in opts.feslist}" onclick="{parent.onSelectFes}"><dl><dt><p class="day"><span class="bgcolor" each="{date in fes.date}" > {moment(date.start).format(\'MM/DD\')} <span class="small">{moment(date.start).format(\'dd\')}</span></span></p><p class="title">{fes.name}</p></dt><dd><a href="javascript:void(0)"><img class="roll_fout" src="images/common/88ab18a0.pic01.jpg"></a></dd></dl></li></ul>',"fes-list .festival-list { padding: 0 20px; } fes-list .festival-list-date { width: 300px; float: left; margin-right: 30px; margin-bottom: 30px; } fes-list .festival-list-date .day { font-size: 26px; font-family: 'Merriweather', serif; font-weight: 400; color: #fff; margin-bottom: 3px; letter-spacing: 0.1em; } fes-list .festival-list-date .day .small { font-size: 18px; } fes-list .festival-list-date .day .bgcolor { background: #dc79a2; padding: 6px; margin-right: 5px; } fes-list .festival-list-date .title { background: #4c4c4c; padding: 8px; font-size: 26px; font-weight: bold; color: #fff; margin-bottom: 0; } fes-list .festival-list-date:nth-child(3n) { margin-right: 0px; } fes-list .festival-list:after { content: \".\"; display: block; height: 0; font-size: 0; clear: both; visibility: hidden; } @media only screen and (max-width: 640px) { fes-list .festival-list { padding: 0; } fes-list .festival-list-date { width: 100%; float: none; position: relative; margin-right: 0; margin-bottom: 1px; } fes-list .festival-list-date dt { position: absolute; top: 20px; left: 10px; } fes-list .festival-list-date dt .day { font-size: 18px; font-family: 'Merriweather', serif; font-weight: 400; color: #fff; margin-bottom: 5px; letter-spacing: 0.1em; } fes-list .festival-list-date dt .day .small { font-size: 14px; } fes-list .festival-list-date dt .day .bgcolor { background: #dc79a2; padding: 8px; } fes-list .festival-list-date dt .title { background: #4c4c4c; padding: 8px; font-size: 18px; font-weight: bold; color: #fff; margin-bottom: 0; } fes-list .festival-list-date dd { height: 110px; overflow: hidden; background: #383838; } fes-list .festival-list-date dd img { width: 100%; } fes-list .festival-list-date:nth-child(3n) { margin-right: 6%; } fes-list .festival-list-date:nth-child(2n) { margin-right: 0; } }",function(a){this.onSelectFes=function(a){riot.route("detail/"+a.item.fes.id)}.bind(this)}),riot.tag("fes-map",'<div id="map-result"></div>',function(a){function b(a,b){c.setView([a,b],12);var d=L.icon({iconUrl:"images/5005034b.icon_pointer.png",iconRetinaUrl:"images/5005034b.icon_pointer.png",iconSize:[35,35],iconAnchor:[17,17],popupAnchor:[0,0]}),e={icon:d,clickable:!1,draggable:!1,opacity:.9};L.marker([a,b],e).addTo(c)}var c=L.map(this["map-result"],{dragging:!0});L.tileLayer("http://{s}.mqcdn.com/tiles/1.0.0/osm/{z}/{x}/{y}.png",{maxZoom:18,subdomains:["otile1","otile2","otile3","otile4"],attribution:'Tiles courtesy of <a href="http://www.mapquest.com/" target="_blank">MapQuest</a> <img src="http://developer.mapquest.com/content/osm/mq_logo.png">. Map data (c) <a href="http://www.openstreetmap.org/" target="_blank">OpenStreetMap</a> contributors, CC-BY-SA.'}).addTo(c);var d=L.markerClusterGroup();d.addTo(c),this.on("show",function(){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(a){b(a.coords.latitude,a.coords.longitude)},function(a){b(35.6098733,140.1138984)},{enableHighAccuracy:!0,timeout:8e3,maximumAge:0}):b(35.6098733,140.1138984)}),this.on("update",function(){d.clearLayers(),_.each(a.feslist,function(a){var b=L.marker(new L.LatLng(a.location.lat,a.location["long"])).bindLabel(a.name,{noHide:!0,clickable:!0});b.on("click",function(b){riot.route("detail/"+a.id)}),b.label.on("click",function(b){riot.route("detail/"+a.id)}),d.addLayer(b)})})}),function(){"use strict";riot.route.parser(function(a){var b=a.split("?"),c=[b[0]],d=b[1],e={};return d&&d.split("&").forEach(function(a){var b=a.split("=");e[b[0]]=b[1]}),c.push(e),c}),riot.route.currentPath=function(){var a=location.href.match(/#([^\?]*)/);return a.length>1?a[1]:""},riot.observable(riot.route);var a="",b=null,c=function(c,d){c=c||"home";var e=c.split("/"),f=a.split("/");m(function(){for(var g="",h=0;h<e.length;h++){var i=e[h],j=f[h];i!==j?(riot.route.trigger("routeChange"+(""===g?"":":")+g,i),g+=(""===g?"":"/")+i,riot.route.trigger(g,d)):_.isEqual(d,b)?g+=(""===g?"":"/")+i:(g+=(""===g?"":"/")+i,riot.route.trigger(g,d))}a=c,b=d})},d=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/MSIE/),e=!1,f="Webkit Moz O ms Khtml".split(" "),g=document.createElement("div");if(void 0!==g.style.animationName&&(e=!0),!e)for(var h=0;h<f.length;h++)if(void 0!==g.style[f[h]+"AnimationName"]){e=!0;break}var i={display:"block",opacity:0,position:"absolute",left:e?"0px":"20px",right:0,top:0,bottom:0},j={left:"0px",opacity:1},k={left:"",top:"",right:"",bottom:"",position:"",opacity:""},l=function(a){a.removeClass("entrance-in entrance-out")},m=function(a){var b=$("body"),c=function(){b.scrollTop(0),a&&a(),b.css(i),e?(l(b),b.addClass("entrance-in"),setTimeout(function(){l(b),b.css(k)},500)):b.animate(j,{duration:500,easing:"swing",always:function(){b.css(k)}})};e&&!d?(l(b),b.addClass("entrance-out"),setTimeout(c,100)):b.fadeOut({duration:100,always:c})};riot.route.attacheExec=function(a,b){a=$(a);var c=setInterval(function(){a.length&&a.is(":visible")&&(clearInterval(c),b())},50)},riot.route(c),riot.route.build=function(){$("body").hide(),this.exec(c)}}(),function(a){"use strict";var b=function(){};b.prototype={url:"http://codeforchiba.github.io/feschibal/data/test-data2.json",dataStore:null,findAll:function(){if(this.dataStore){var a=new $.Deferred;return a.resolve(_.values(this.dataStore)),a.promise()}var b=this;return this._getJSON(this.url).then(function(a){b.dataStore={};var c=_.map(a,function(a){return a.date=_.map(a.date,function(a){return a.start=new Date(a.start),a.end=new Date(a.end),a}),b.dataStore[a.id]=new cfc.Event(a),b.dataStore[a.id]});return c})},findOne:function(a){var b=this;if(this.dataStore){var c=new $.Deferred,d=b.dataStore[a];return d?c.resolve(d):c.reject(),c.promise()}return this.findAll().then(function(){var c=new $.Deferred,d=b.dataStore[a];return d?c.resolve(d):c.reject(),c.promise()})},_getJSON:function(a){return $.getJSON(a)},_jsonp:function(a,b){var c=document.createElement("script");c.async=!0;var d="exec"+Math.floor(65535*Math.random()+1);window[d]=function(a){var c=document.getElementById(d);c.parentNode.removeChild(c),b(a),window[d]=null,delete window[d]};var e=a.indexOf("?")>-1?"&":"?";c.src=a+e+"callback="+d,c.id=d,document.getElementsByTagName("head")[0].appendChild(c)}},a.EventStore=b}(window.cfc=window.cfc||{}),function(a){"use strict";var b=function(a){for(var b in a)this[b]=a[b]};b.prototype={getStartDate:function(){return this.date[0].start},getEndDate:function(){return this.date[this.date.length-1].end}},b.dataStore=new cfc.EventStore,b.findAll=function(){return this.dataStore.findAll()},b.find=function(a){return this.findAll().then(function(b){return _.filter(b,function(b){var c=!1;if(a.fromDate&&(c=_.some(b.date,function(b){return b.end.getTime()>a.fromDate.getTime()}),!c))return!1;if(a.toDate&&(c=_.some(b.date,function(b){return b.start.getTime()<a.toDate.getTime()}),!c))return!1;if(a.basePoint&&null!=a.distance){var d=L.latLng([b.location.lat,b.location["long"]]);if(b.distance=d.distanceTo(a.basePoint),b.distance>a.distance)return!1}return!0})}).then(function(b){if(null!=a.limit&&null!=a.pageNo){var c=a.limit*a.pageNo,d=a.limit*(a.pageNo+1)-1;return{total:b.length,limit:a.limit,pageNo:a.pageNo,list:_.filter(b,function(a,b){return b>=c&&d>=b})}}return{total:b.length,list:b}})},b.findOne=function(a){return this.dataStore.findOne(a)},a.Event=b}(window.cfc=window.cfc||{});