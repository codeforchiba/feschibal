!function(a){var b=a.L;b.labelVersion="0.2.2-dev",b.Label=(b.Layer?b.Layer:b.Class).extend({includes:b.Mixin.Events,options:{className:"",clickable:!1,direction:"right",noHide:!1,offset:[12,-15],opacity:1,zoomAnimation:!0},initialize:function(a,c){b.setOptions(this,a),this._source=c,this._animated=b.Browser.any3d&&this.options.zoomAnimation,this._isOpen=!1},onAdd:function(a){this._map=a,this._pane=this.options.pane?a._panes[this.options.pane]:this._source instanceof b.Marker?a._panes.markerPane:a._panes.popupPane,this._container||this._initLayout(),this._pane.appendChild(this._container),this._initInteraction(),this._update(),this.setOpacity(this.options.opacity),a.on("moveend",this._onMoveEnd,this).on("viewreset",this._onViewReset,this),this._animated&&a.on("zoomanim",this._zoomAnimation,this),b.Browser.touch&&!this.options.noHide&&(b.DomEvent.on(this._container,"click",this.close,this),a.on("click",this.close,this))},onRemove:function(a){this._pane.removeChild(this._container),a.off({zoomanim:this._zoomAnimation,moveend:this._onMoveEnd,viewreset:this._onViewReset},this),this._removeInteraction(),this._map=null},setLatLng:function(a){return this._latlng=b.latLng(a),this._map&&this._updatePosition(),this},setContent:function(a){return this._previousContent=this._content,this._content=a,this._updateContent(),this},close:function(){var a=this._map;a&&(b.Browser.touch&&!this.options.noHide&&(b.DomEvent.off(this._container,"click",this.close),a.off("click",this.close,this)),a.removeLayer(this))},updateZIndex:function(a){this._zIndex=a,this._container&&this._zIndex&&(this._container.style.zIndex=a)},setOpacity:function(a){this.options.opacity=a,this._container&&b.DomUtil.setOpacity(this._container,a)},_initLayout:function(){this._container=b.DomUtil.create("div","leaflet-label "+this.options.className+" leaflet-zoom-animated"),this.updateZIndex(this._zIndex)},_update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updatePosition(),this._container.style.visibility="")},_updateContent:function(){this._content&&this._map&&this._prevContent!==this._content&&"string"==typeof this._content&&(this._container.innerHTML=this._content,this._prevContent=this._content,this._labelWidth=this._container.offsetWidth)},_updatePosition:function(){var a=this._map.latLngToLayerPoint(this._latlng);this._setPosition(a)},_setPosition:function(a){var c=this._map,d=this._container,e=c.latLngToContainerPoint(c.getCenter()),f=c.layerPointToContainerPoint(a),g=this.options.direction,h=this._labelWidth,i=b.point(this.options.offset);"right"===g||"auto"===g&&f.x<e.x?(b.DomUtil.addClass(d,"leaflet-label-right"),b.DomUtil.removeClass(d,"leaflet-label-left"),a=a.add(i)):(b.DomUtil.addClass(d,"leaflet-label-left"),b.DomUtil.removeClass(d,"leaflet-label-right"),a=a.add(b.point(-i.x-h,i.y))),b.DomUtil.setPosition(d,a)},_zoomAnimation:function(a){var b=this._map._latLngToNewLayerPoint(this._latlng,a.zoom,a.center).round();this._setPosition(b)},_onMoveEnd:function(){this._animated&&"auto"!==this.options.direction||this._updatePosition()},_onViewReset:function(a){a&&a.hard&&this._update()},_initInteraction:function(){if(this.options.clickable){var a=this._container,c=["dblclick","mousedown","mouseover","mouseout","contextmenu"];b.DomUtil.addClass(a,"leaflet-clickable"),b.DomEvent.on(a,"click",this._onMouseClick,this);for(var d=0;c.length>d;d++)b.DomEvent.on(a,c[d],this._fireMouseEvent,this)}},_removeInteraction:function(){if(this.options.clickable){var a=this._container,c=["dblclick","mousedown","mouseover","mouseout","contextmenu"];b.DomUtil.removeClass(a,"leaflet-clickable"),b.DomEvent.off(a,"click",this._onMouseClick,this);for(var d=0;c.length>d;d++)b.DomEvent.off(a,c[d],this._fireMouseEvent,this)}},_onMouseClick:function(a){this.hasEventListeners(a.type)&&b.DomEvent.stopPropagation(a),this.fire(a.type,{originalEvent:a})},_fireMouseEvent:function(a){this.fire(a.type,{originalEvent:a}),"contextmenu"===a.type&&this.hasEventListeners(a.type)&&b.DomEvent.preventDefault(a),"mousedown"!==a.type?b.DomEvent.stopPropagation(a):b.DomEvent.preventDefault(a)}}),b.BaseMarkerMethods={showLabel:function(){return this.label&&this._map&&(this.label.setLatLng(this._latlng),this._map.showLabel(this.label)),this},hideLabel:function(){return this.label&&this.label.close(),this},setLabelNoHide:function(a){this._labelNoHide!==a&&(this._labelNoHide=a,a?(this._removeLabelRevealHandlers(),this.showLabel()):(this._addLabelRevealHandlers(),this.hideLabel()))},bindLabel:function(a,c){var d=this.options.icon?this.options.icon.options.labelAnchor:this.options.labelAnchor,e=b.point(d)||b.point(0,0);return e=e.add(b.Label.prototype.options.offset),c&&c.offset&&(e=e.add(c.offset)),c=b.Util.extend({offset:e},c),this._labelNoHide=c.noHide,this.label||(this._labelNoHide||this._addLabelRevealHandlers(),this.on("remove",this.hideLabel,this).on("move",this._moveLabel,this).on("add",this._onMarkerAdd,this),this._hasLabelHandlers=!0),this.label=new b.Label(c,this).setContent(a),this},unbindLabel:function(){return this.label&&(this.hideLabel(),this.label=null,this._hasLabelHandlers&&(this._labelNoHide||this._removeLabelRevealHandlers(),this.off("remove",this.hideLabel,this).off("move",this._moveLabel,this).off("add",this._onMarkerAdd,this)),this._hasLabelHandlers=!1),this},updateLabelContent:function(a){this.label&&this.label.setContent(a)},getLabel:function(){return this.label},_onMarkerAdd:function(){this._labelNoHide&&this.showLabel()},_addLabelRevealHandlers:function(){this.on("mouseover",this.showLabel,this).on("mouseout",this.hideLabel,this),b.Browser.touch&&this.on("click",this.showLabel,this)},_removeLabelRevealHandlers:function(){this.off("mouseover",this.showLabel,this).off("mouseout",this.hideLabel,this),b.Browser.touch&&this.off("click",this.showLabel,this)},_moveLabel:function(a){this.label.setLatLng(a.latlng)}},b.Icon.Default.mergeOptions({labelAnchor:new b.Point(9,-20)}),b.Marker.mergeOptions({icon:new b.Icon.Default}),b.Marker.include(b.BaseMarkerMethods),b.Marker.include({_originalUpdateZIndex:b.Marker.prototype._updateZIndex,_updateZIndex:function(a){var b=this._zIndex+a;this._originalUpdateZIndex(a),this.label&&this.label.updateZIndex(b)},_originalSetOpacity:b.Marker.prototype.setOpacity,setOpacity:function(a,b){this.options.labelHasSemiTransparency=b,this._originalSetOpacity(a)},_originalUpdateOpacity:b.Marker.prototype._updateOpacity,_updateOpacity:function(){var a=0===this.options.opacity?0:1;this._originalUpdateOpacity(),this.label&&this.label.setOpacity(this.options.labelHasSemiTransparency?this.options.opacity:a)},_originalSetLatLng:b.Marker.prototype.setLatLng,setLatLng:function(a){return this.label&&!this._labelNoHide&&this.hideLabel(),this._originalSetLatLng(a)}}),b.CircleMarker.mergeOptions({labelAnchor:new b.Point(0,0)}),b.CircleMarker.include(b.BaseMarkerMethods),b.Path.include({bindLabel:function(a,c){return this.label&&this.label.options===c||(this.label=new b.Label(c,this)),this.label.setContent(a),this._showLabelAdded||(this.on("mouseover",this._showLabel,this).on("mousemove",this._moveLabel,this).on("mouseout remove",this._hideLabel,this),b.Browser.touch&&this.on("click",this._showLabel,this),this._showLabelAdded=!0),this},unbindLabel:function(){return this.label&&(this._hideLabel(),this.label=null,this._showLabelAdded=!1,this.off("mouseover",this._showLabel,this).off("mousemove",this._moveLabel,this).off("mouseout remove",this._hideLabel,this)),this},updateLabelContent:function(a){this.label&&this.label.setContent(a)},_showLabel:function(a){this.label.setLatLng(a.latlng),this._map.showLabel(this.label)},_moveLabel:function(a){this.label.setLatLng(a.latlng)},_hideLabel:function(){this.label.close()}}),b.Map.include({showLabel:function(a){return this.addLayer(a)}}),b.FeatureGroup.include({clearLayers:function(){return this.unbindLabel(),this.eachLayer(this.removeLayer,this),this},bindLabel:function(a,b){return this.invoke("bindLabel",a,b)},unbindLabel:function(){return this.invoke("unbindLabel")},updateLabelContent:function(a){this.invoke("updateLabelContent",a)}})}(window,document);