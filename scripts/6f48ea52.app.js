riot.tag("app",'<app-header></app-header><div class="content"><home if="{path === \'home\'}" listener="{listener}"></home><search if="{path === \'search\'}" listener="{listener}"></search><fes-detail-modal fes="{fes}"></fes-detail-modal></div><app-footer></app-footer>',"app .content { padding: 15px; }",function(a){var b=this;this.path=null,this.fes=null,this.listener={onSelectFes:function(a){b.fes=a,b.update(),$("fes-detail-modal > div").modal("show")}},riot.route.on("routeChange",function(a){console.log("routeChange path="+a),b.path=a,b.update()})}),riot.tag("app-header",'<div class="navbar navbar-inverse navbar-fixed-top" role="navigation"><div class="container-fluid"><div class="navbar-header"><a class="navbar-brand" href="#">Feschibal</a></div></div></div>',function(a){}),riot.tag("app-footer",'<footer class="well well-sm"><small>footer of Feschibal</small></footer>',function(a){}),riot.tag("home",'<div class="panel panel-default"><div class="panel-heading"><h3 class="panel-title">直近に開催される祭り</h3></div><div class="panel-body"><fes-list listener="{opts.listener}" request="{request}"></fes-list></div></div><div class="panel panel-default"><div class="panel-heading"><h3 class="panel-title">祭りを検索する</h3></div><div class="panel-body row"><div class="col-lg-6"><h4>地域から探す</h4></div><div class="col-lg-6"><h4>日付から探す</h4><table class="table"><tbody><tr><td><a href="#search/list?param1=value1&param2=value2">本日開催の祭り</a></td></tr><tr><td><a href="#search/list?param1=value3&param2=value4">今週開催の祭り</a></td></tr><tr><td><a href="#search/list?param1=value5&param2=value6">今度の土日開催の祭り</a></td></tr></tbody></table></div></div></div>',function(a){var b=this;this.request=riot.observable(),riot.route.on("home",function(a){console.log("attach home param="+JSON.stringify(a)),$.getJSON("data/home-test-data.json",function(a){b.request.trigger("loaded",a)})})}),riot.tag("search",'<div class="row"><div class="col-lg-3"><div class="panel panel-default"><div class="panel-heading"><h3 class="panel-title">祭りを検索する</h3></div><div class="panel-body"><form class="form-horizontal" onsubmit="{onSubmitSearch}"><h4>期間を指定する</h4><div class="form-group"><label for="fromDate" class="col-sm-2 control-label">From:</label><div class="col-sm-10"><input type="text" class="form-control" id="fromDate" ></div></div><div class="form-group"><label for="toDate" class="col-sm-2 control-label">To:</label><div class="col-sm-10"><input type="text" class="form-control" id="toDate" ></div></div><h4>地域を指定する</h4><div class="form-group"><div class="col-sm-offset-2 col-sm-10"><button type="submit" class="btn btn-default">検索する</button></div></div></form></div></div></div><div class="col-lg-9"><ul class="nav nav-tabs"><li role="presentation" class="{active: path===\'list\'}"><a href="#search/list?{queryString}">一覧表示</a></li><li role="presentation" class="{active: path===\'cal\'}"><a href="#search/cal?{queryString}">カレンダー表示</a></li></ul><div><fes-list if="{path === \'list\'}" request="{request}" listener="{opts.listener}"></fes-list><fes-calendar if="{path === \'cal\'}" request="{request}" listener="{opts.listener}"></fes-calendar></div></div></div>',function(a){var b=this,c={format:"yyyy/mm/dd",language:"ja",orientation:"top",todayHighlight:!0,autoclose:!0,clearBtn:!0};$(this.fromDate).datepicker(c),$(this.toDate).datepicker(c),this.request=riot.observable(),this.path=null,this.queryString=null,this.onSubmitSearch=function(a){feschibal.Event.findAll(function(a){console.log(JSON.stringify(a))})}.bind(this),riot.route.on("routeChange:search",function(a){console.log("routeChange:search path="+a),b.path=a,b.update()}),riot.route.on("search",function(a){console.log("attach search param="+JSON.stringify(a)),b.queryString=$.param(a),b.update(),$.getJSON("data/test-data.json",function(a){return b.request.trigger("loaded",a),!1})})}),riot.tag("fes-list",'<div class="row"><div class="col-lg-3"><table class="table table-hover"><thead><tr><th>検索結果：100 件中 1-10 件</th></tr></thead><tbody><tr each="{fes, i in fesList}" onclick="{parent.onSelectFes}"><td><div>{fes.start}</div><div>{fes.name}</div></td></tr></tbody></table><nav><ul class="pager"><li class="previous disabled"><a href="javascript:void(0);"><span aria-hidden="true">&larr;</span> 前へ</a></li><li class="next"><a href="javascript:void(0);">次へ <span aria-hidden="true">&rarr;</span></a></li></ul></nav></div><div class="col-lg-9" id="map"></div></div>',"#map { height: 500px; }",function(a){function b(a,b){d=L.map(g[0]).setView([a,b],12),e.addTo(d),d.addLayer(f);var c=L.icon({iconUrl:"../../images/icon_pointer.png",iconRetinaUrl:"../../images/icon_pointer.png",iconSize:[35,35],iconAnchor:[17,17],popupAnchor:[0,0]}),h={icon:c,clickable:!1,draggable:!1,opacity:.9};L.marker([a,b],h).addTo(d)}var c=this;c.fesList=[],a.request.on("loaded",function(b){c.fesList=b,c.update(),f.clearLayers(),_.each(b,function(b){var c=L.marker(new L.LatLng(b.coordinates[1],b.coordinates[0])).bindLabel(b.name,{noHide:!0,clickable:!0});c.on("click",function(c){a.listener.onSelectFes(b)}),c.label.on("click",function(c){a.listener.onSelectFes(b)}),f.addLayer(c)})});var d,e=L.tileLayer("http://cyberjapandata.gsi.go.jp/xyz/std/{z}/{x}/{y}.png",{maxZoom:18,attribution:"<a href='http://www.gsi.go.jp/kikakuchousei/kikakuchousei40182.html' target='_blank'>国土地理院</a>",opacity:.8}),f=L.markerClusterGroup(),g=$(this.map),h=setInterval(function(){g.length&&g.is(":visible")&&(clearInterval(h),navigator.geolocation?navigator.geolocation.getCurrentPosition(function(a){b(a.coords.latitude,a.coords.longitude)},function(a){b(35.6098733,140.1138984)},{enableHighAccuracy:!0,timeout:8e3,maximumAge:0}):b(35.6098733,140.1138984))},50);this.onSelectFes=function(a){d.panTo(new L.LatLng(a.item.fes.coordinates[1],a.item.fes.coordinates[0])),$("fes-detail-modal > div").modal("show")}.bind(this)}),riot.tag("fes-calendar",'<div id="calendar"></div>',"fes-calendar .fc-event { margin-bottom: 5px; padding: 5px; cursor: pointer; } fes-calendar .fc-event:hover { opacity: 0.8; } fes-calendar .fc-event .fc-content { white-space: normal; } fes-calendar .fc-event .fc-content .fc-time { display: block; }",function(a){var b=this,c=$(this.calendar),d=[];riot.route.on("search/cal",function(b){c.fullCalendar({lang:"ja",eventClick:function(b,c,d){return a.listener.onSelectFes(b.fes),!1},events:d})}),a.request.on("loaded",function(a){b.fesList=a,d=_.map(a,function(a){return{title:a.name,start:a.start,end:a.end,fes:a}}),c.fullCalendar("removeEvents"),c.fullCalendar("addEventSource",d)})}),riot.tag("fes-detail-modal",'<div class="modal fade" tabindex="-1" role="dialog"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button class="close" type="button" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title text-primary">{opts.fes.name}</h4></div><div class="modal-body"><div class="panel panel-section"><div class="panel-heading"><h3 class="panel-title">期間</h3></div><div class="panel-body"> 2015年3月6日（金曜日）11時00分から2015年3月6日（金曜日）11時30分 </div></div><div class="panel panel-section"><div class="panel-heading"><h3 class="panel-title">祭り内容</h3></div><div class="panel-body"><dl class="dl-horizontal"><dt>目玉</dt><dd>2千人規模で踊る親子三代千葉おどり</dd></dl><img src="../../images/chiba-odori.jpg" alt=""></div><table class="table table-bordered"><thred><tr><th>踊り</th><th>歌唱</th><th>太鼓</th><th>演奏</th><th>出店・屋台</th><th>花火</th><th>その他</th></tr></thred><tbody><tr><td><i class="fa fa-check"></i></td><td></td><td><i class="fa fa-check"></i></td><td></td><td><i class="fa fa-check"></i></td><td><i class="fa fa-check"></i></td><td class="other">スポーツイベント、フリーマーケット</td></tr></tbody></table><dl class="dl-horizontal"><dt>祭り公式サイト</dt><dd><a href="http://www.bikai.org/matsuri.html">http://www.bikai.org/matsuri.html</a></dd></dl></div><div class="panel panel-section"><div class="panel-heading"><h3 class="panel-title">場所</h3></div><div class="panel-body"><dl class="dl-horizontal"><dt>会場</dt><dd>中央公園</dd><dt>住所</dt><dd>中央区中央1-12-1</dd></dl><div id="detail-map"></div></div></div><div class="panel panel-section"><div class="panel-heading"><h3 class="panel-title">主催、共催、後援</h3></div><div class="panel-body"><dl class="dl-horizontal"><dt>主催</dt><dd>千葉市を美しくする会</dd><dt>共催</dt><dd>千葉市市民自治推進課</dd><dt>担当者</dt><dd>千葉 祭</dd><dt>電話番号</dt><dd>043-999-9999</dd></dl></div></div></div><div class="modal-footer"><button type="button" class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div>',"fes-detail-modal .panel.panel-section { -webkit-box-shadow: none; box-shadow: none; } fes-detail-modal .panel.panel-section .panel-heading { border-bottom: 3px solid #e5e5e5; } fes-detail-modal .dl-horizontal dt { width: 60px; } fes-detail-modal .dl-horizontal dd { margin-left: 80px; } fes-detail-modal .table.table-bordered th, fes-detail-modal .table.table-bordered td { text-align: center; } fes-detail-modal .table.table-bordered td.other { text-align: left; } fes-detail-modal #detail-map { height: 300px; }",function(a){var b=$(this["detail-map"]),c=setInterval(function(){if(b.length&&b.is(":visible")){clearInterval(c);var d=L.map(b[0]).setView([a.fes.coordinates[1],a.fes.coordinates[0]],14);L.marker([a.fes.coordinates[1],a.fes.coordinates[0]]).addTo(d),L.tileLayer("http://cyberjapandata.gsi.go.jp/xyz/std/{z}/{x}/{y}.png",{maxZoom:18,attribution:"<a href='http://www.gsi.go.jp/kikakuchousei/kikakuchousei40182.html' target='_blank'>国土地理院</a>",opacity:.8}).addTo(d)}},50)}),function(){riot.route.parser(function(a){var b=a.split("?"),c=[b[0]],d=b[1],e={};return d&&d.split("&").forEach(function(a){var b=a.split("=");e[b[0]]=b[1]}),c.push(e),c}),riot.observable(riot.route);var a="",b=null,c=function(c,d){c=c||"home";for(var e=c.split("/"),f=a.split("/"),g="",h=0;h<e.length;h++){var i=e[h],j=f[h];i!==j?(riot.route.trigger("routeChange"+(""===g?"":":")+g,i),g+=(""===g?"":"/")+i,riot.route.trigger(g,d)):_.isEqual(d,b)?g+=(""===g?"":"/")+i:(g+=(""===g?"":"/")+i,riot.route.trigger(g,d))}a=c,b=d};riot.route(c),riot.route.build=function(){this.exec(c)}}(),function(a){var b=function(){};b.prototype={findAll:function(a){var b=this;this._jsonp("http://linkdata.org/api/1/rdf1s3024i/matsuri_list_v2_rdf.json",function(c){var d=[];for(var e in c){var f=new feschibal.Event;f.id=c[e]["http://www.w3.org/2000/01/rdf-schema#label"][0].value,f.isExposeName=b._booleanValue(c[e],"公開可否(名前)"),f.name=b._strValue(c[e],"名前"),f.isExposeDate=b._booleanValue(c[e],"公開可否(日時)"),f.startDate=new Date(b._strValue(c[e],"開始日")+" "+b._strValue(c[e],"開始時刻")),f.endDate=new Date(b._strValue(c[e],"終了日")+" "+b._strValue(c[e],"終了時刻")),f.isExposePlace=b._booleanValue(c[e],"公開可否(会場)"),f.place=b._strValue(c[e],"会場名"),f.address=b._strValue(c[e],"住所"),f.isExposeContents=b._booleanValue(c[e],"公開可否(祭り内容)");var g=b._strValue(c[e],"祭り内容").split(",");f.hasDancing=g.indexOf("踊り")>=0,f.hasSinging=g.indexOf("歌唱")>=0,f.hasDrum=g.indexOf("太鼓")>=0,f.hasMusicalPerformance=g.indexOf("演奏")>=0,f.hasFoodStall=g.indexOf("屋台")>=0,f.hasFireworks=g.indexOf("花火")>=0,f.isExposeSpecialProgram=b._booleanValue(c[e],"公開可否(祭りの目玉)"),f.specialProgram=b._strValue(c[e],"祭りの目玉"),f.isExposeParticipation=b._booleanValue(c[e],"公開可否(一般参加)"),f.canParticipate=b._booleanValue(c[e],"一般参加可否"),f.officialSite=b._strValue(c[e],"ウェブサイト"),f.isExposeSponsor=b._booleanValue(c[e],"公開可否(主催団体)"),f.sponsorGroup=b._strValue(c[e],"主催団体"),f.isExposeContactGroup=b._booleanValue(c[e],"公開可否(問い合わせ先・名前)"),f.contactGroup=b._strValue(c[e],"問い合わせ先・名前"),f.isExposeContactPerson=b._booleanValue(c[e],"公開可否(問い合わせ先・担当者)"),f.contactPerson=b._strValue(c[e],"問い合わせ先・担当者"),f.isExposeContactTel=b._booleanValue(c[e],"公開可否(問い合わせ先・電話番号)"),f.contactTel=b._strValue(c[e],"問い合わせ先・電話番号"),f.isExposeContactMail=b._booleanValue(c[e],"公開可否(問い合わせ先・メールアドレス)"),f.contactMail=b._strValue(c[e],"問い合わせ先・メールアドレス"),d.push(f)}a&&a(d)})},_strValue:function(a,b){var c=a[this._jsonkey(b)];return c?c[0].value:""},_booleanValue:function(a,b){return"1"===this._strValue(a,b)},_jsonkey:function(a){return"http://linkdata.org/property/rdf1s3024i#"+encodeURIComponent(a).replace("(","%28").replace(")","%29")},_jsonp:function(a,b){var c=document.createElement("script");c.async=!0;var d="exec"+Math.floor(65535*Math.random()+1);window[d]=function(a){var c=document.getElementById(d);c.parentNode.removeChild(c),b(a),window[d]=null,delete window[d]};var e=a.indexOf("?")>-1?"&":"?";c.src=a+e+"callback="+d,c.id=d,document.getElementsByTagName("head")[0].appendChild(c)}},a.EventStore=b}(window.feschibal=window.feschibal||{}),function(a){var b=function(){};b.prototype={id:null,isExposeName:!1,name:null,isExposeDate:!1,startDate:null,endDate:null,isExposePlace:!1,place:null,address:null,coordinates:null,isExposeContents:!1,hasDancing:!1,hasSinging:!1,hasDrum:!1,hasMusicalPerformance:!1,hasFoodStall:!1,hasFireworks:!1,other:null,isExposeSpecialProgram:!1,specialProgram:null,isExposeParticipation:!1,canParticipate:!1,officialSite:null,isExposeSponsor:!1,sponsorGroup:null,isExposeContactGroup:!1,contactGroup:null,isExposeContactPerson:!1,contactPerson:null,isExposeContactTel:!1,contactTel:null,isExposeContactMail:!1,contactMail:null},b.dataStore=new feschibal.EventStore,b.findAll=function(a){this.dataStore.findAll(function(b){a&&a(b)})},a.Event=b}(window.feschibal=window.feschibal||{});